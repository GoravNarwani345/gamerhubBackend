# GamerHub Streaming & Chat System Documentation

## Overview
Complete streaming platform with live streams, viewer management, chat with likes/replies, and profile system.

---

## üé¨ STREAMING EVENTS (Socket.io)

### 1. START STREAM (Streamer)
**Event:** `startStream`
```javascript
socket.emit('startStream', {
  streamId: '64f5c3e5...',
  userId: '64f5c3e5...',
  title: 'Gaming Live',
  description: 'Playing latest games',
  category: 'Gaming'
});
```
**Response:** `streamLive` - Notifies all users that stream went live

---

### 2. JOIN STREAM (Viewer)
**Event:** `joinStream`
```javascript
socket.emit('joinStream', {
  streamId: '64f5c3e5...',
  userId: '64f5c3e5...'
});
```
**Response:** 
- `streamerProfile` - Streamer info sent to viewer
- `viewerCountUpdated` - Updates all viewers with new count

---

### 3. LEAVE STREAM (Viewer)
**Event:** `leaveStream`
```javascript
socket.emit('leaveStream', {
  streamId: '64f5c3e5...',
  userId: '64f5c3e5...'
});
```
**Response:** `viewerCountUpdated` - Notifies all viewers

---

### 4. END STREAM (Streamer)
**Event:** `endStream`
```javascript
socket.emit('endStream', {
  streamId: '64f5c3e5...',
  userId: '64f5c3e5...'
});
```
**Response:** `streamEnded` - Notifies all viewers stream ended

---

### 5. STREAM VIDEO (Streamer)
**Event:** `publishStreamVideo`
```javascript
socket.emit('publishStreamVideo', {
  streamId: '64f5c3e5...',
  userId: '64f5c3e5...',
  videoUrl: 'https://cdn.example.com/streams/stream123/segment.m3u8',
  metadata: { thumbnail: 'https://...', quality: '720p' }
});
```
**Response (broadcast):** `streamVideo` ‚Äî Sent to all viewers in the stream room with `{ streamId, videoUrl, metadata, timestamp }`. Clients should switch/update their player/source when receiving this event.

Notes:
- `publishStreamVideo` is intended to publish the current video source (HLS URL, m3u8, WebRTC offer URL, or mp4 chunk URL) so all viewers in the room see the same stream.
- The server will also update `stream.thumbnail` if `metadata.thumbnail` is provided.

---

### 6. HIGHLIGHT EVENTS (AI or Client Generated)
**Event:** `saveHighlight` (socket) or `POST /api/highlights` (REST)
```javascript
// Socket example
socket.emit('saveHighlight', {
  streamId: '64f5c3e5...',
  streamerId: '64f5c3e5...',
  clipUrl: 'https://cdn.example.com/highlights/clip123.mp4',
  thumbnail: 'https://cdn.example.com/highlights/thumb123.jpg',
  duration: 12.5,
  tags: ['kill', 'headshot'],
  generatedBy: 'ai'
});
```
**Response (broadcast):** `highlightSaved` ‚Äî Sent to the stream room with highlight metadata; sender receives `highlightAck`.

**REST:** `POST /api/highlights` ‚Äî protected endpoint to store highlight metadata. Use `GET /api/highlights/stream/:streamId` or `/api/highlights/streamer/:streamerId` to fetch saved clips.

Notes:
- Highlights are small clips (shorts) generated by server-side AI or the client. The server stores metadata and returns an ID for retrieval.
- Clients should host clip files on a CDN or storage service and send the public `clipUrl` to the server.


## üí¨ CHAT EVENTS (Socket.io)

### 1. SEND MESSAGE
**Event:** `sendMessage`
```javascript
socket.emit('sendMessage', {
  streamId: '64f5c3e5...',
  userId: '64f5c3e5...',
  messageText: 'Amazing stream!',
  username: 'viewer123'
});
```
**Response:** `newMessage` - Message received by all viewers

---

### 2. LIKE MESSAGE
**Event:** `likeMessage`
```javascript
socket.emit('likeMessage', {
  messageId: '64f5c3e5...',
  streamId: '64f5c3e5...',
  userId: '64f5c3e5...'
});
```
**Response:** `messageLiked` - Updates like count

---

### 3. REPLY TO MESSAGE
**Event:** `replyToMessage`
```javascript
socket.emit('replyToMessage', {
  messageId: '64f5c3e5...',
  streamId: '64f5c3e5...',
  userId: '64f5c3e5...',
  username: 'viewer123',
  userAvatar: 'avatar_url',
  replyText: 'Totally agree!'
});
```
**Response:** `messageReply` - Reply added to message

---

### 4. UPDATE MESSAGE
**Event:** `updateMessage`
```javascript
socket.emit('updateMessage', {
  messageId: '64f5c3e5...',
  streamId: '64f5c3e5...',
  messageText: 'Updated message'
});
```
**Response:** `messageUpdated` - Message text updated

---

### 5. DELETE MESSAGE
**Event:** `deleteMessage`
```javascript
socket.emit('deleteMessage', {
  messageId: '64f5c3e5...',
  streamId: '64f5c3e5...'
});
```
**Response:** `messageDeleted` - Message deleted

---

## üë§ PROFILE EVENTS (Socket.io)

### 1. GET STREAMER PROFILE
**Event:** `getStreamerProfile`
```javascript
socket.emit('getStreamerProfile', {
  streamerId: '64f5c3e5...'
});
```
**Response:** `streamerProfile` with all streamer info

---

### 2. GET VIEWER PROFILE
**Event:** `getViewerProfile`
```javascript
socket.emit('getViewerProfile', {
  viewerId: '64f5c3e5...'
});
```
**Response:** `viewerProfile` with user info

---

### 3. FOLLOW STREAMER
**Event:** `followStreamer`
```javascript
socket.emit('followStreamer', {
  streamerId: '64f5c3e5...',
  userId: '64f5c3e5...'
});
```
**Response:** `streamerFollowed` - Increments followers count

---

## üì° REST API ENDPOINTS

### STREAMS
| Method | Endpoint | Auth | Description |
|--------|----------|------|-------------|
| GET | `/api/streams/live` | ‚ùå | Get all live streams |
| GET | `/api/streams/:streamId` | ‚ùå | Get stream by ID |
| POST | `/api/streams/create` | ‚úÖ | Create new stream |
| GET | `/api/streams/user/streams` | ‚úÖ | Get user's streams |
| PUT | `/api/streams/:streamId` | ‚úÖ | Update stream info |
| GET | `/api/streams/:streamId/analytics` | ‚úÖ | Get stream analytics |
| GET | `/api/streams/category/:category` | ‚ùå | Get streams by category |
| GET | `/api/streams/search?query=text` | ‚ùå | Search streams |

---

### PROFILES
| Method | Endpoint | Auth | Description |
|--------|----------|------|-------------|
| GET | `/api/profiles/:userId` | ‚ùå | Get any user profile |
| GET | `/api/profiles/me/profile` | ‚úÖ | Get current user profile |
| PUT | `/api/profiles/me/update` | ‚úÖ | Update profile info |
| GET | `/api/profiles/streamer/:streamerId` | ‚ùå | Get streamer info (modal) |
| GET | `/api/profiles/viewer/:viewerId` | ‚ùå | Get viewer info (modal) |
| POST | `/api/profiles/:userId/follow` | ‚úÖ | Follow a user |
| GET | `/api/profiles/trending/top-streamers` | ‚ùå | Get top streamers |

---

## üìä DATABASE SCHEMA

### User Model
```javascript
{
  username: String,
  email: String,
  password: String,
  avatar: String,
  bio: String,
  followers: Number,
  following: Number,
  isStreamer: Boolean,
  streamTitle: String,
  streamCategory: String,
  // ... other fields
}
```

### Stream Model
```javascript
{
  userId: ObjectId,
  title: String,
  description: String,
  category: String,
  thumbnail: String,
  status: 'live' | 'offline',
  viewersCount: Number,
  viewers: [ObjectId],
  totalLikes: Number,
  totalComments: Number,
  startedAt: Date,
  endedAt: Date,
  isActive: Boolean,
  createdAt: Date
}
```

### Message Model
```javascript
{
  streamId: ObjectId,
  userId: ObjectId,
  messageText: String,
  likes: Number,
  likedBy: [ObjectId],
  replies: [{
    userId: ObjectId,
    text: String,
    timestamp: Date
  }],
  timestamp: Date,
  isFlagged: Boolean
}
```

---

## üîê AUTHENTICATION
All endpoints marked with ‚úÖ require Bearer token in Authorization header:
```
Authorization: Bearer <jwt_token>
```

---

## ‚ú® FEATURES INCLUDED

‚úÖ Multiple viewers can join one stream
‚úÖ Real-time chat with likes and replies
‚úÖ Stream comments counter
‚úÖ Viewer count tracking
‚úÖ Streamer and viewer profiles
‚úÖ Follow/Unfollow system
‚úÖ Stream categories
‚úÖ Stream search
‚úÖ Stream analytics
‚úÖ Top streamers
‚úÖ Profile modals for users
‚úÖ Stream lifecycle (create, start, end)

---

## üöÄ USAGE EXAMPLE (Frontend)

```javascript
// Connect to socket
const socket = io('http://localhost:8000');

// Streamer starts stream
socket.emit('startStream', {
  streamId: 'stream123',
  userId: 'user123',
  title: 'Gaming Live',
  category: 'Gaming'
});

// Viewer joins
socket.emit('joinStream', {
  streamId: 'stream123',
  userId: 'viewer456'
});

// Listen for stream live notification
socket.on('streamLive', (data) => {
  console.log(`${data.streamerName} is now live!`);
});

// Send message
socket.emit('sendMessage', {
  streamId: 'stream123',
  userId: 'viewer456',
  messageText: 'Great stream!',
  username: 'viewer456'
});

// Like a message
socket.emit('likeMessage', {
  messageId: 'msg123',
  streamId: 'stream123',
  userId: 'viewer456'
});

// Get streamer profile
socket.emit('getStreamerProfile', {
  streamerId: 'streamer123'
});

// Listen for profile data
socket.on('streamerProfile', (profile) => {
  console.log(`${profile.username} - ${profile.followers} followers`);
});
```

---

## üîÑ Data Flow

```
Frontend connects to Socket
       ‚Üì
emit 'joinStream'
       ‚Üì
Server validates user & stream
       ‚Üì
Add user to stream room
       ‚Üì
emit 'streamerProfile' to user
       ‚Üì
emit 'viewerCountUpdated' to all in room
       ‚Üì
User can now send messages, like, reply
       ‚Üì
All viewers see updates in real-time
```

---

This setup provides a complete streaming platform ready for production use! üéâ
